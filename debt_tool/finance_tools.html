<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="financetools.css" />
   <title>Finance Tools</title>
   <h1>Debt Payoff Calculator</h1>
   <h4>This program gives you the mathematically best way to pay off your debt, using the avalanche method.
    
   </h4>

   <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <label for="debtNum">Number of Debts:</label>
    <input type="text" id="debtNum" name="debtNum" placeholder="0">

    <button onclick="addDebts()">Enter</button>

    <script>
    
        var startDebt = 0;

        var containers = [];
        function addDebts() {
            Clear();
            var debtNum = parseInt(document.getElementById("debtNum").value);
            if (!isNaN(debtNum)) {
                var existingButton = document.getElementById("addButton");
                if (existingButton) {
                    document.body.removeChild(existingButton);
                }

               
                var incContainer = document.getElementById("incContainer");
                if (incContainer) {
                    document.body.removeChild(incContainer);
                }
                

                if (startDebt > debtNum) {
                    var difference = startDebt - debtNum;
                    for (var z = 0; z < difference; z++) {

                        var lastContainer = containers.pop();
                        document.body.removeChild(lastContainer);
                        startDebt = startDebt - 1;
                    }

                } else {
                    for (var i = startDebt; i < debtNum; i++) {
                        startDebt = startDebt + 1;
                        var container = document.createElement("div");
                        container.appendChild(document.createElement("br"));
                        document.body.appendChild(container);

                        

                        for (var y = 0; y < 4; y++) {
                                
                            var label = document.createElement("label");

                            var newInput = document.createElement("input");
                            newInput.type = "text";
                            newInput.name = "dynamicInput";
                            newInput.placeholder = "enter";

                            if (y == 0) { 
                               
                                label.for = "debtName" + (i+1);
                                label.innerHTML = " Debt " + (i + 1) + " Name: ";
                                newInput.id = "debtName" + (i+1);
                                newInput.placeholder = "Enter";
                    
                            } else if (y == 1) {
                               
                                label.for = "debtAmount" +  (i+1);
                                label.innerHTML = "  Debt Amount $";
                                newInput.id = "debtAmount" +  (i+1);
                                newInput.placeholder = "0";
                    
                            } else if (y == 2) {
                                
                                label.for = "debtInterest" +  (i+1);
                                label.innerHTML = "  Interest Rate(%): ";
                                newInput.id = "debtInterest" +  (i+1);
                                newInput.placeholder = "0";
                                    
                            } else { // y == 3
                             
                                label.for = "debtMin" + (i+1);
                                label.innerHTML = "  Min Monthly Payment: $";
                                newInput.id = "debtMin" + (i+1);
                                newInput.placeholder = "0";
                            }

                            container.appendChild(label);
                            container.appendChild(newInput);
                            container.appendChild(document.createElement("br"));
                                
                        }
                        document.body.appendChild(container);
                        containers.push(container);

                    }
                }
                if (debtNum > 0) {

                    var container2 = document.createElement("div");
                    container2.id = "incContainer";

                    container2.appendChild(document.createElement("br"));

                    var incomeInput = document.createElement("input");
                    incomeInput.type = "text";
                    incomeInput.name = "dynamicInput";
                    incomeInput.placeholder = "enter";
                        
                    var incomeLabel = document.createElement("label");
                    incomeLabel.for = "income";
                    incomeLabel.innerHTML = "Monthly Take-Home Income: $";
                    incomeInput.id = "income";
                    incomeInput.placeholder = "0"


                    container2.appendChild(incomeLabel);
                    container2.appendChild(incomeInput);

                    container2.appendChild(document.createElement("br"));

                    var expensesInput = document.createElement("input");
                    expensesInput.type = "text";
                    expensesInput.name = "dynamicInput";
                    expensesInput.placeholder = "0";

                    var expensesLabel = document.createElement("label");
                    expensesLabel.for = "expenses";
                        
                    expensesLabel.innerHTML = "Monthly Expenses (not including debt): $";
                    expensesInput.id = "expenses";
                    expensesInput.placeholder = "0"

                    container2.appendChild(expensesLabel);
                    container2.appendChild(expensesInput);

                    container2.appendChild(document.createElement("br"));
                    document.body.appendChild(container2);

                    
                    var addButton = document.createElement("button");
                    addButton.id = "addButton"
                    addButton.innerHTML = "Calculate";
                    addButton.onclick = function() {
                        calculateDebts(); 
                    };
                    document.body.appendChild(addButton);
                }

            } else {
                alert("Please enter a valid number.");
            }
        }
    
        function calculateDebts() {


            var schContainer = document.createElement("div");
            schContainer.for = "schContainer";
            schContainer.id = "schContainer";

            Clear();

            var clearButton = document.createElement("button");
            clearButton.id = "clearButton"
            clearButton.innerHTML = "Clear";
            clearButton.onclick = function() {
                Clear(); 
            };
            document.body.appendChild(clearButton);


            var debtList = [];
            var TOTAL_DEBT = 0;

            function interestSort(debt) {
                return debt['interest'];
            }
            
            for (var i = 1; i <= startDebt; i++) {
                var debtName = document.getElementById("debtName" + i).value;
                var debtAmount = parseFloat(document.getElementById("debtAmount" + i).value);
                var debtInterest = parseFloat(document.getElementById("debtInterest" + i).value);
                var debtMin = parseFloat(document.getElementById("debtMin" + i).value);
                
                if (!isNaN(debtAmount) && !isNaN(debtInterest) && !isNaN(debtMin)) { 
                    var debtInfo = {
                                    'name': debtName,
                                    'amount': debtAmount,
                                    'interest': debtInterest,
                                    'min_mp': debtMin,
                                    'month_pay': 0
                                };

                    debtList.push(debtInfo);
                    TOTAL_DEBT += debtAmount;
                } else {
                    document.body.removeChild(clearButton);
                    alert("Please enter a valid number.");
                    return 0;
                }
            }

            debtList.sort((a, b) => interestSort(b) - interestSort(a));

            
            var totalDebt = document.createElement("p");

            
            totalDebt.innerHTML = "Starting Total Debt: $" + TOTAL_DEBT;
    
            schContainer.appendChild(totalDebt);

            var monthIncome = parseFloat(document.getElementById("income").value);
            var monthExpenses = parseFloat(document.getElementById("expenses").value);
            var incomePostExpenses = monthIncome - monthExpenses;

            var postIncome = document.createElement("p");
            postIncome.innerHTML = "Monthly Income After Expenses: $" + incomePostExpenses;        

            if (!isNaN(TOTAL_DEBT) && !isNaN(incomePostExpenses)) {
                alert("Please enter a valid number.");
                return 0;
            }
                

            schContainer.appendChild(postIncome);
            
            // Initialize Values
            var month = 1;
            var Total_DoT = [TOTAL_DEBT];
            var debtTime = [debtList.map(d => d['amount'])];

            

            
            while (TOTAL_DEBT > 0) {
                schContainer.appendChild(document.createElement("br"));

                var money_left = incomePostExpenses;
                
                var text2 = document.createElement("p");
                text2.innerHTML = "Month " + month + ":";
                schContainer.appendChild(text2);

                var text3 = document.createElement('p');
                text3.innerHTML = " STARTING TOTAL DEBT: $" + TOTAL_DEBT.toFixed(2);
                schContainer.appendChild(text3);
                month++;

                // update dict values (min mps and monthly totals )
                // pay min mps



                for (var x = 0; x < debtList.length; x++) {
                    // update dictionary values
                    var debt = debtList[x];
                    debt['month_pay'] = 0;
                    if (debt['amount'] < debt['min_mp']) {
                        debt['min_mp'] = debt['amount'];
                    }

                    // pay min mps
                    if (debt['min_mp'] <= money_left) {
                        debt['amount'] -= debt['min_mp'];
                        money_left -= debt['min_mp'];
                        debt['month_pay'] += debt['min_mp'];
                    } else {
                        // min monthly is more than money left
                        debt['amount'] -= money_left;
                        debt['month_pay'] += money_left;
                        money_left = 0;
                    }
                }
                TOTAL_DEBT = 0;

                 // pay BEYOND min mps
                for (var z = 0; z < debtList.length; z++) {
                    var debt = debtList[z];
                    if (debt['amount'] <= money_left) {
                        debt['month_pay'] += debt['amount'];
                        money_left -= debt['amount'];
                        debt['amount'] = 0;
                    } else {
                        debt['amount'] -= money_left;
                        debt['month_pay'] += money_left;
                        money_left = 0;
                    }

                    debt['amount'] = parseFloat((debt['amount'] * (1 + (debt['interest'] / 100) / 12)).toFixed(2));

                    TOTAL_DEBT += debt['amount'];   
                    var text4 = document.createElement('p');
                    text4.innerHTML = debt['name'] + " Payment: $" + debt['month_pay'].toFixed(2);
                    schContainer.appendChild(text4);
                    
                }
                Total_DoT.push(TOTAL_DEBT);
                debtTime.push(debtList.map(d => d['amount']));
            }

            
            schContainer.appendChild(document.createElement("br"));

            var text5 = document.createElement('p');
            text5.innerHTML = "Month " + month + ":";
            schContainer.appendChild(text5);

           
            var text6 = document.createElement('p');
            text6.innerHTML = " DEBT FULLY PAID OFF";
            schContainer.appendChild(text6);

            //Plotting 

            // Create months array 
            var months = []
            for (var i = 1; i <= Total_DoT.length; i++) {
                months.push(i);
            }

            const debtGraph = {
                x: months,
                y: Total_DoT,
                type: 'scatter',
                name: 'Total Debt'
            };

            const debtGraphs = [];
            debtGraphs.push(debtGraph)
            
            for (let i = 0; i < debtList.length; i++) {
                const debtHistory = debtTime.map(debtMonth => debtMonth[i]);
                debtGraphs.push({
                    x: months,
                    y: debtHistory,
                    type: 'scatter',
                    name: debtList[i]['name']
                });
            }

            const layout = {
                title: 'Debt Over Time',
                xaxis: {
                    title: 'Month',
                    range: [1,],
                    fixedrange: true
                    
                },
                yaxis: {
                    title: 'Total Debt',
                    fixedrange: true
                }
            };
            
            var plotlyContainer = document.createElement('div');
            plotlyContainer.id = "Debt Schedule";

            document.body.appendChild(plotlyContainer);
            document.body.appendChild(schContainer);

            if (debtList.length <= 1) {
                Plotly.newPlot("Debt Schedule", [debtGraph], layout);
            } else {
                Plotly.newPlot("Debt Schedule", debtGraphs, layout);
            }
        }

        function Clear() {
            var clButton = document.getElementById("schContainer");
            var removeButton = document.getElementById("clearButton")
            if (clButton) {
                document.body.removeChild(clButton);
                document.body.removeChild(removeButton);
            }
        }
    </script>
</body>
</html>
